name: Deploy to GitHub Pages
on:
  push:
    branches: ["main"] # –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –ø—É—à–µ –≤ main
  workflow_dispatch:   # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é –∫–Ω–æ–ø–∫—É
permissions:
  contents: read
  pages: write
  id-token: write
concurrency:
  group: "pages"
  cancel-in-progress: true
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v4
      - name: Cache Busting üî®
        run: |
          # –°–æ–∑–¥–∞–µ–º –≤–µ—Ä—Å–∏—é (—Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
          VERSION=$(date +%s)
          # –ò—â–µ–º –≤—Å–µ .html —Ñ–∞–π–ª—ã –∏ –º–µ–Ω—è–µ–º __ASSETS_VERSION__ –Ω–∞ —Ü–∏—Ñ—Ä—ã
          # sed -i –¥–µ–ª–∞–µ—Ç –∑–∞–º–µ–Ω—É "in-place" (–≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞) —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–±–æ—Ä–∫–∏
          find . -name "*.html" -print0 | xargs -0 sed -i "s/__ASSETS_VERSION__/$VERSION/g"
          echo "Deployed version: $VERSION"
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: . # –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å—ë –∏–∑ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–∏
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages üöÄ
        id: deployment
        uses: actions/deploy-pages@v4